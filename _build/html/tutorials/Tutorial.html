

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AMBER - main.py &mdash; AMBER  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api/index.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AMBER
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#install-the-package">Install the Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#optional-extras">Optional extras</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#minimal-run">Minimal run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#command-line-cluster">Command-line (cluster)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration file</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#common-keys-fill-from-your-config-files">Common keys (fill from your CONFIG files)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Simulation pipeline</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">AMBER - main.py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Import-Statements">Import Statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#CONFIGURATION-file">CONFIGURATION file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Setting-up-the-simulation">Setting up the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Generate-vasculature.">Generate vasculature.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Prepare-the-process-of-the-simulation">Prepare the process of the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-the-simulation">Run the simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/amber.html">AMBER package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AMBER</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">AMBER - main.py</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/Tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="AMBER---main.py">
<h1>AMBER - main.py<a class="headerlink" href="#AMBER---main.py" title="Link to this heading"></a></h1>
<section id="Import-Statements">
<h2>Import Statements<a class="headerlink" href="#Import-Statements" title="Link to this heading"></a></h2>
<p>Specify the path to the package avoids bugs when running on cluster. Import the necessary packages and modules.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>import sys
sys.path.insert(0, &#39;/PHShome/lk001/.conda/envs/amberenv/lib/python3.9/site-packages&#39;) #cluster
import amber
import numpy as np
import random
import time
import os
print(&#39;Current working directory:&#39;, os.getcwd())
#print the directory of amber and version
print(&#39;Amber directory:&#39;, amber.__file__)
print(&#39;Amber version:&#39;, amber.__version__)
</pre></div>
</div>
</div>
</section>
<section id="CONFIGURATION-file">
<h2>CONFIGURATION file<a class="headerlink" href="#CONFIGURATION-file" title="Link to this heading"></a></h2>
<p>Make sur the config file is give and read the config file. Store it in a class called config. Set up the random seed for the simulation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>if len(sys.argv) &gt; 1:
    config_file = sys.argv[1]
else:
    raise ValueError(&#39;No config file specified&#39;)

config_dict = amber.read_config_file(config_file)
config = amber.Config(config_dict)
print(&#39;Config file: &#39;, &#39;-&#39;*50)

#set up the seed for the simulation
seed = config.seed
print(&#39;python version&#39;, sys.version)
print(&#39;Config file&#39;, config_file)
print(&#39;seed&#39;, seed)

np.random.seed(seed)
random.seed(seed)

for key, value in config_dict.items():
    print(key, value)
</pre></div>
</div>
</div>
</section>
<section id="Setting-up-the-simulation">
<h2>Setting up the simulation<a class="headerlink" href="#Setting-up-the-simulation" title="Link to this heading"></a></h2>
<p>You first need to create the instance of the World class. This class contains all the information about the simulation. It contains the voxels, the cells, the vasculature, the molecules, etc. It is the geometry of the simulation. You can then add normal cells in all voxels and tumor cells in the center of the geometry.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span>world = amber.World(config)

#add cells to the voxels (Normal stroma cells and tumor cells)
for i in range(world.total_number_of_voxels):
    if i %10000 == 0: print(&#39;Adding healthy cells to voxel number: &#39;, i, &#39; out of &#39;, world.total_number_of_voxels)
    for j in range(config.initial_number_healthy_cells):
        cell = amber.Cell(config.radius_healthy_cells, cycle_hours=config.doubling_time_healthy, cycle_std=config.doubling_time_sd, radiosensitivity=config.radiosensitivity, o2_to_vitality_factor=config.o2_to_vitality_factor, type=&#39;NormalCell&#39;)
        cell.time_spent_cycling = 0
        world.voxel_list[i].add_cell(cell)

points = amber.Sphere(config.tumor_initial_radius, [0, 0, 0]).generate_random_points(config.initial_number_tumor_cells)
for i in range(config.initial_number_tumor_cells):
    if i % 10000 == 0: print(&#39;Adding tumor cells &#39;, i, &#39; out of &#39;, config.initial_number_tumor_cells)
    voxel = world.find_voxel(points[i])
    voxel.add_cell(
        amber.Cell(config.radius_tumor_cells, cycle_hours=config.doubling_time_tumor, cycle_std=config.doubling_time_sd, intra_radiosensitivity=config.intra_radiosensitivity, o2_to_vitality_factor=config.o2_to_vitality_factor, type=&#39;TumorCell&#39;))
</pre></div>
</div>
</div>
</section>
<section id="Generate-vasculature.">
<h2>Generate vasculature.<a class="headerlink" href="#Generate-vasculature." title="Link to this heading"></a></h2>
<p>Then we need to generate the vasculature. We use healthy vasculature generator implemented to do so. Tweaking the parameters will lead to a differentaly shaped vasculature. The oxygen distribution is then updated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>#generate vasculature and print related information
world.generate_healthy_vasculature(config.vessel_number,
            splitting_rate=0.5,
            mult_macro_steps=2.0,
            micro_steps=20,
            weight_direction=2.0,
            weight_vegf=0.9,
            weight_pressure=0.0,
            )
world.update_volume_occupied_by_vessels()
print(&#39;Relative volume occupied by vessels, ratio: &#39;, 100*(world.measure_vasculature_volume()/(world.half_length*2)**3), &#39;%&#39;)
print(&#39;Length of vasculature: &#39;, 100*(world.measure_vasculature_length()/(world.half_length*2)**3), &#39;mm/mm^3&#39;)
print(&#39;Area of vasculature: &#39;, 10*(world.measure_vasculature_area()/(world.half_length*2)**3), &#39;mm^2/mm^3&#39;)
world.update_capillaries(o2_per_volume=config.o2_per_volume, diffusion_number=config.diffusion_number)
</pre></div>
</div>
</div>
</section>
<section id="Prepare-the-process-of-the-simulation">
<h2>Prepare the process of the simulation<a class="headerlink" href="#Prepare-the-process-of-the-simulation" title="Link to this heading"></a></h2>
<p>The process are the different steps that will be executed at each time step. The order of the process is important and can be chosen when inputing the list of the process to the simulator class. The simulator class is in charge of running the simulation and creating the output files.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span>#prepare the simulation
end_time = config.endtime
dt = config.dt

celldivision = amber.CellDivision( config, &#39;cell_division&#39;, dt,
                                        cycling_threshold=config.vitality_cycling_threshold,
                                        pressure_threshold=config.pressure_threshold_division)

celldeath = amber.CellDeath(config, &#39;cell_death&#39;, dt,
                                        apoptosis_threshold=config.vitality_apoptosis_threshold,
                                        apoptosis_probability=config.probability_apoptosis,
                                        necrosis_threshold=config.vitality_necrosis_threshold,
                                        necrosis_probability=config.probability_necrosis)

cellaging = amber.CellAging(config, &#39;cell_aging&#39;, dt)

cellmigration = amber.CellMigration(config, &#39;cell_migration&#39;, dt,
                                        pressure_threshold=config.pressure_threshold_migration)

update_cell_state = amber.UpdateCellOxygen(config, &#39;update_cell_state&#39;, dt,
                                        voxel_half_length=(config.half_length_world/config.voxel_per_side),
                                        effective_vessel_radius=config.effective_vessel_radius)

update_molecules = amber.UpdateVoxelMolecules(config, &#39;update_molecules&#39;, dt,
                                        VEGF_production_per_cell=config.VEGF_production_per_cell,
                                        threshold_for_VEGF_production=config.o2_threshold_for_VEGF_production)

update_vessels = amber.UpdateVasculature(config, &#39;update_vessels&#39;, dt,
                                        killing_radius_threshold=config.radius_killing_threshold,
                                        killing_length_threshold=config.length_killing_threshold,
                                        o2_per_volume=config.o2_per_volume,
                                        diffusion_number=config.diffusion_number,
                                        splitting_rate=config.splitting_rate_vasculature,
                                        macro_steps=config.macro_steps,
                                        micro_steps=config.micro_steps,
                                        weight_direction=config.weight_direction,
                                        weight_vegf=config.weight_vegf,
                                        weight_pressure=config.weight_pressure,
                                        radius_pressure_sensitive=config.radius_pressure_sensitive)

list_of_processes = [update_cell_state, celldivision, celldeath, update_molecules, cellaging, cellmigration, update_vessels]

sim = amber.Simulator(config, list_of_processes, end_time, dt)
</pre></div>
</div>
</div>
</section>
<section id="Run-the-simulation">
<h2>Run the simulation<a class="headerlink" href="#Run-the-simulation" title="Link to this heading"></a></h2>
<p>There is only one step left, running everything!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>sim.run(world, video=config.show_time_steps)
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Bertolet Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>